<h1>Vox Modular Architecture Overview</h1>
<h2>Entry Point</h2>
<ul>
<li><strong><code>vox/fastapi_app.py</code></strong></li>
<li>This is the main entry point for the application, run with Hypercorn.</li>
<li>It initializes the FastAPI application (<code>app</code>) and the Socket.IO server (<code>sio</code>).</li>
<li>It creates an <code>sio_app</code> that wraps the FastAPI app to handle both HTTP and Socket.IO traffic.</li>
<li>It sets up middleware for sessions and rate limiting.</li>
<li>It mounts the <code>/static</code> directory for serving static files.</li>
<li>It initializes the database connection pool on startup.</li>
<li>It includes all the API routers from the other modules in the <code>vox</code> package.</li>
</ul>
<h2>Package Structure (<code>vox/</code>)</h2>
<p><code>vox/
├── __init__.py          # Makes the 'vox' directory a Python package.
├── fastapi_app.py       # Main application entry point (FastAPI and Socket.IO setup).
├── main.py              # Router for the main application routes (e.g., the home page).
├── user.py              # Router for user-related operations (profile, etc.).
├── auth.py              # Router for authentication (e.g., Discord OAuth).
├── recordings.py        # Router for handling recording-related API calls.
├── chat.py              # Router for the chat endpoint with the LLM.
├── socketio_handlers.py # Defines all Socket.IO event handlers.
├── audio_processing.py  # Contains functions for audio feature extraction.
├── database.py          # Helper functions for interacting with the database.
├── utils.py             # Utility functions and constants.
├── llm.py               # Logic for interacting with the LLM (OpenRouter).
├── limiter.py           # Rate limiter configuration.
├── templates.py         # Template rendering setup.</code></p>
<h2>API Routers</h2>
<p>The application is organized into several <code>APIRouter</code> modules, which are included in the main <code>FastAPI</code> app in <code>vox/fastapi_app.py</code>:</p>
<ul>
<li><strong><code>main_router</code></strong>: <code>/</code> (home page)</li>
<li><strong><code>user_router</code></strong>: <code>/user</code> (user info, profile)</li>
<li><strong><code>auth_router</code></strong>: <code>/auth</code> (authentication)</li>
<li><strong><code>recordings_router</code></strong>: <code>/recordings</code> (saving/managing recordings)</li>
<li><strong><code>chat_router</code></strong>: <code>/chat</code> (chat endpoint)</li>
</ul>
<h2>Socket.IO Events</h2>
<p>Handlers for real-time communication are defined in <code>vox/socketio_handlers.py</code>:</p>
<ul>
<li><code>connect</code>: Handles a new client connection.</li>
<li><code>disconnect</code>: Handles a client disconnection.</li>
<li><code>start_recording</code>: Signals the start of a recording session.</li>
<li><code>stop_recording</code>: Signals the end of a recording session and triggers LLM feedback.</li>
<li><code>raw_audio</code>: Receives raw audio data from the client for real-time analysis.</li>
<li><code>save_recording</code>: Handles the event to save a recording.</li>
</ul>
<h2>Constants &amp; Config</h2>
<ul>
<li><strong>Environment Variables</strong>: API keys, database URLs, and secret keys are managed through environment variables (loaded from a <code>.env</code> file).</li>
<li><strong>LLM Prompt</strong>: The base prompt for the LLM is defined in <code>vox/utils.py</code>.</li>
<li><strong>Static Files</strong>: Located in the <code>static/</code> directory.</li>
<li><strong>Templates</strong>: Located in the <code>templates/</code> directory.</li>
</ul>
<h2>Database</h2>
<ul>
<li><strong>PostgreSQL</strong>: The application uses a PostgreSQL database, hosted on Supabase.</li>
<li><strong><code>asyncpg</code></strong>: The <code>asyncpg</code> library is used for asynchronous database access.</li>
<li><strong>Connection Pool</strong>: A connection pool is created on application startup in <code>vox/fastapi_app.py</code>.</li>
<li><strong>Database Helpers</strong>: Asynchronous database helper functions are located in <code>vox/database.py</code>.</li>
</ul>
<h2>LLM Integration</h2>
<ul>
<li><strong>OpenRouter</strong>: The application integrates with the OpenRouter API to access various language models.</li>
<li><strong><code>vox/llm.py</code></strong>: This module contains the logic for constructing prompts and making API calls to the LLM.</li>
<li>The LLM is used for generating personalized feedback on voice recordings and for the chat feature.</li>
</ul>
<hr />
<p><em>Last updated: August 31, 2025</em></p>